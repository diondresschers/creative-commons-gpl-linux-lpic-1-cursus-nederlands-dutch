102.2 Het installeren van een bootmanager



---


---

GRUB

vi /boot/grub/menu.lst # sometimes it's a symbolic link

hidden menu
default0 # which stansa choise is the default
timeout 3

title Ubuntu 9.04, kernel 2.6.28-16-generic
kernel /boot/vmlinuz-.... root=UUID=.... ro single

title Ubuntu 14.04, kernel 3.0.... (recovery mode)# # RUNLEVEL 1
kernel /boot/vmlinuz-.... root=UUID=.... ro single # single is RUNLEVEL 1

title WIndows
root (hd1,0)
chainloader +1

-

GRUB on other partitions

sudo grub-install /dev/sda # installeert grub op een schijf

---

backup bootloader

mount # see all drives, check wich partition is on root!!!
dd # writes sector to sector van dump device
dd if=/dev/sda of=/root/master_boot_record_backup bs=512 count=1 # 512 bytes, filename of backup.mbr maakt niks uit # count=1 moet erbij anders de  hele harde schijf...

ls -l /boot/master_boot_record # zie de size...

# bij kapot maken, stop een CD erin... en dan:
dd if/root/master_boot_record_backup of=/dev/sda bs=512 count=1

----------

MBR
/boot/grub/menu.lst
grub-install
superblock


De bootloader is de eerste sector van een (hard)disk. Het gaat om de eerste 512 bytes.
De bootloader is dus kleiner dan 512 bytes, het zijn dat de bootloader meteen de kernel laadt en start (en is officieel geen onderdeel van het besturingssysteem).
Nu is het bij moderne Linux distributies zo dat die bootloader de partitietabel interpreteert en kijkt naar partities die zijn gemarkteerd als 'bootable'.
Dan start de bootloader de bootsector van die partitie en voert het uit. Deze bootsector bevat een tweede bootloader (vaker een bootmanager zoals GRUB) die de kernel van het besturingssysteem laadt en uitvoert.
Via een bootmanager (GRUB) kan gekozen worden tussen meerdere besturingssystemen en meerdere kernels.

----

superblock

Het superblock is het onderdeel van een filesysteem.
Het superblock bevat metadata over het fileysysteem zoals de grootte en de status.
Het aanpassen van het superblock kan leiden tot een niet werkend systeem.
Er worden meerdere backups van het superblock weggeschreven, deze kan je ook weer terugzetten.

sudo dumpe2fs /dev/sda1 | grep -i superblock

Om een superblock terug te zetten
e2fsck -f -b 8193 /dev/sda1

----

GRUB is een bootmanager.
GRUB heeft de oudere bootmanager 'LILO' vervangen.
Er bestaan GRUB en GRUB2, deze termen kunnen door elkaar heen gebruikt worden. Om de oude GRUB aan te duiden kan je gebruik maken van de term 'GRUB Legacy'.

-----

/boot/grub/menu.lst

GRUB Legacy gebruikt '/boot/grub/menu.lst' om het selectiemenu weer te geven bij opstarten.
GRUB2 gebruikt hiervoor '/boot/grub/grub.cfg'.
In de GRUB config wordt geen gebruik gemaakt van de benaming '/dev/sda', maar hier heet deze hd0.
De eerste partitie in Grub Legacy is 0 en de eerste partitie in GRUB2 is vreemdgenoeg 1.
'hd0,1' is dus de tweede GRUB Legacy partitie van '/dev/sda' en de eerste partitie van GRUB2.
'default' geeft aan welke OS standaard gestard moet worden
'timeout' geeft aan hoeveel seconden de gebruiker de tijd heeft om de het starten te onderbreken
'slashimage' geeft het grafische plaatje bij het opstarten
'title' geeft de titel aan van het OS.
'kernel' geeft het image van de kernel aan die gestart wordt.
Het RAM-disk kan aangepast worden in 'initrd'
GRUB2 gebruikt geen 'title' maar 'menuentry' zet dubbele quotes om de tekst heen en de config van die 'menuentry' is omsloten door accolades.
Zo zijn er nog meer wijzigingen die GRUB2 






# grub.conf generated by anaconda
#
# Note that you do not have to rerun grub after making changes to this file
# NOTICE:  You have a /boot partition.  This means that
#          all kernel and initrd paths are relative to /boot/, eg.
#          root (hd0,0)
#          kernel /vmlinuz-version ro root=/dev/mapper/VolGroup-lv_root
#          initrd /initrd-[generic-]version.img
#boot=/dev/sda
default=0
timeout=5
splashimage=(hd0,0)/grub/splash.xpm.gz
hiddenmenu
title CentOS (2.6.32-431.el6.x86_64)
	root (hd0,0)
	kernel /vmlinuz-2.6.32-431.el6.x86_64 ro root=/dev/mapper/VolGroup-lv_root rd_NO_LUKS LANG=en_US.UTF-8 rd_NO_MD rd_LVM_LV=VolGroup/lv_swap SYSFONT=latarcyrheb-sun16 crashkernel=auto rd_LVM_LV=VolGroup/lv_root  KEYBOARDTYPE=pc KEYTABLE=us rd_NO_DM rhgb quiet
	initrd /initramfs-2.6.32-431.el6.x86_64.img


cat /boot/grub/menu.lst

Je kan het GRUB boot menu aanpassen bij het opstarten.
Druk de ESC-toets als je het menu niet ziet
Druk de 'E'-toets om de lijn aan te passen
Gebruik de 'B'-toets om te booten.

DEMO CAT GRUB en GRUB2

---

In de 'BIOS' wordt bepaald wat de opstartvolgorde is van het systeem (bv eerst 'DVD', dan 'USB' en dan 'HD').
Het MBR is de eerste 512 bytes van een die (harde)schijf of (hard)disk of CD/DVD.
Het MBR kan weer doorverwijzen naar een bootsector waar weer een bootmanager staat of kan een direct een kernel starten.

Je kan dit MBR voor de zekerheid backuppen via:

mount # see all drives, check wich partition is on root!!!
dd # writes sector to sector van dump device
dd if=/dev/sda of=/root/master_boot_record_backup bs=512 count=1 # 512 bytes, filename of backup.mbr maakt niks uit # count=1 moet erbij anders de  hele harde schijf...

ls -l /boot/master_boot_record # zie de size...

# bij kapot maken, stop een CD erin... en dan:
dd if/root/master_boot_record_backup of=/dev/sda bs=512 count=1

----

102.2 Het installeren van een bootmanager



---


---

GRUB

vi /boot/grub/menu.lst # sometimes it's a symbolic link

hidden menu
default0 # which stansa choise is the default
timeout 3

title Ubuntu 9.04, kernel 2.6.28-16-generic
kernel /boot/vmlinuz-.... root=UUID=.... ro single

title Ubuntu 14.04, kernel 3.0.... (recovery mode)# # RUNLEVEL 1
kernel /boot/vmlinuz-.... root=UUID=.... ro single # single is RUNLEVEL 1

title WIndows
root (hd1,0)
chainloader +1

-

GRUB on other partitions

sudo grub-install /dev/sda # installeert grub op een schijf

---

backup bootloader

mount # see all drives, check wich partition is on root!!!
dd # writes sector to sector van dump device
dd if=/dev/sda of=/root/master_boot_record_backup bs=512 count=1 # 512 bytes, filename of backup.mbr maakt niks uit # count=1 moet erbij anders de  hele harde schijf...

ls -l /boot/master_boot_record # zie de size...

# bij kapot maken, stop een CD erin... en dan:
dd if/root/master_boot_record_backup of=/dev/sda bs=512 count=1

----------

MBR
/boot/grub/menu.lst
grub-install
superblock


De bootloader is de eerste sector van een (hard)disk. Het gaat om de eerste 512 bytes.
De bootloader is dus kleiner dan 512 bytes, het zijn dat de bootloader meteen de kernel laadt en start (en is officieel geen onderdeel van het besturingssysteem).
Nu is het bij moderne Linux distributies zo dat die bootloader de partitietabel interpreteert en kijkt naar partities die zijn gemarkteerd als 'bootable'.
Dan start de bootloader de bootsector van die partitie en voert het uit. Deze bootsector bevat een tweede bootloader (vaker een bootmanager zoals GRUB) die de kernel van het besturingssysteem laadt en uitvoert.
Via een bootmanager (GRUB) kan gekozen worden tussen meerdere besturingssystemen en meerdere kernels.

----

superblock

Het superblock is het onderdeel van een filesysteem.
Het superblock bevat metadata over het fileysysteem zoals de grootte en de status.
Het aanpassen van het superblock kan leiden tot een niet werkend systeem.
Er worden meerdere backups van het superblock weggeschreven, deze kan je ook weer terugzetten.

sudo dumpe2fs /dev/sda1 | grep -i superblock

Om een superblock terug te zetten
e2fsck -f -b 8193 /dev/sda1

----

GRUB is een bootmanager.
GRUB heeft de oudere bootmanager 'LILO' vervangen.
Er bestaan GRUB en GRUB2, deze termen kunnen door elkaar heen gebruikt worden. Om de oude GRUB aan te duiden kan je gebruik maken van de term 'GRUB Legacy'.

-----

/boot/grub/menu.lst

GRUB Legacy gebruikt '/boot/grub/menu.lst' om het selectiemenu weer te geven bij opstarten.
GRUB2 gebruikt hiervoor '/boot/grub/grub.cfg'.
In de GRUB config wordt geen gebruik gemaakt van de benaming '/dev/sda', maar hier heet deze hd0.
De eerste partitie in Grub Legacy is 0 en de eerste partitie in GRUB2 is vreemdgenoeg 1.
'hd0,1' is dus de tweede GRUB Legacy partitie van '/dev/sda' en de eerste partitie van GRUB2.
'default' geeft aan welke OS standaard gestard moet worden
'timeout' geeft aan hoeveel seconden de gebruiker de tijd heeft om de het starten te onderbreken
'slashimage' geeft het grafische plaatje bij het opstarten
'title' geeft de titel aan van het OS.
'kernel' geeft het image van de kernel aan die gestart wordt.
Het RAM-disk kan aangepast worden in 'initrd'
GRUB2 gebruikt geen 'title' maar 'menuentry' zet dubbele quotes om de tekst heen en de config van die 'menuentry' is omsloten door accolades.
Zo zijn er nog meer wijzigingen die GRUB2 






# grub.conf generated by anaconda
#
# Note that you do not have to rerun grub after making changes to this file
# NOTICE:  You have a /boot partition.  This means that
#          all kernel and initrd paths are relative to /boot/, eg.
#          root (hd0,0)
#          kernel /vmlinuz-version ro root=/dev/mapper/VolGroup-lv_root
#          initrd /initrd-[generic-]version.img
#boot=/dev/sda
default=0
timeout=5
splashimage=(hd0,0)/grub/splash.xpm.gz
hiddenmenu
title CentOS (2.6.32-431.el6.x86_64)
	root (hd0,0)
	kernel /vmlinuz-2.6.32-431.el6.x86_64 ro root=/dev/mapper/VolGroup-lv_root rd_NO_LUKS LANG=en_US.UTF-8 rd_NO_MD rd_LVM_LV=VolGroup/lv_swap SYSFONT=latarcyrheb-sun16 crashkernel=auto rd_LVM_LV=VolGroup/lv_root  KEYBOARDTYPE=pc KEYTABLE=us rd_NO_DM rhgb quiet
	initrd /initramfs-2.6.32-431.el6.x86_64.img


cat /boot/grub/menu.lst

Je kan het GRUB boot menu aanpassen bij het opstarten.
Druk de ESC-toets als je het menu niet ziet
Druk de 'E'-toets om de lijn aan te passen
Gebruik de 'B'-toets om te booten.

DEMO CAT GRUB en GRUB2

---

In de 'BIOS' wordt bepaald wat de opstartvolgorde is van het systeem (bv eerst 'DVD', dan 'USB' en dan 'HD').
Het MBR is de eerste 512 bytes van een die (harde)schijf of (hard)disk of CD/DVD.
Het MBR kan weer doorverwijzen naar een bootsector waar weer een bootmanager staat of kan een direct een kernel starten.

Je kan dit MBR voor de zekerheid backuppen via:

mount # see all drives, check wich partition is on root!!!
dd # writes sector to sector van dump device
dd if=/dev/sda of=/root/master_boot_record_backup bs=512 count=1 # 512 bytes, filename of backup.mbr maakt niks uit # count=1 moet erbij anders de  hele harde schijf...

ls -l /boot/master_boot_record # zie de size...

# bij kapot maken, stop een CD erin... en dan:
dd if/root/master_boot_record_backup of=/dev/sda bs=512 count=1

----











EXAM!!!

While editing a file in vi, you realie that you are changing the wrong file. What vi command sequence will allow you to quit without saving your changes?
:Q!
:q!
:w!
:wq!

---

An administrator has issued the following command:
grub-install --root-directory=/custom-grub /dev/sda
In which directory will the new menu.lst file be found (Provide the full directory path only without the filename):

Your responce:

/custom-grub/boot/grub

---

You want to save vi changes to the file myfile with :w!, but vi complains it can not write to the file. Therefor you want to check the write permissions on the file. To do this without leaving vi, you type:
:!ls -l myfile
:\ls -l myfile
esc :ls -l myfile
:?ls -l myfile

---

You've downloaded an image file of a boot floppy disk to your hard drive. What is the best utility to create a boot floppy from the disk image? (Specify a single command without options)

Your response:

dd












